{"ast":null,"code":"import _toConsumableArray from\"C:/dev/frontend/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/dev/frontend/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/dev/frontend/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from\"react\";import{BrowserRouter,Routes,Route,Link,useNavigate}from\"react-router-dom\";import Main from\"./Main\";import Footer from\"./Footer\";import PopupWithForm from\"./PopupWithForm\";import ImagePopup from\"./ImagePopup\";import Header from\"./Header\";import Api from\"../utils/Api\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup \";import Register from\"./Register\";import LogIn from\"./Login\";import InfoTooltip from\"./InfoToolTip/InfoTooltip\";import ProtectedRoute from\"./ProtectedRoute\";import NavButton from\"./Nav/NavButton\";import sendAuth from\"../utils/Auth\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import react from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var history=useNavigate();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),loggedIn=_React$useState2[0],setLoggedIn=_React$useState2[1];//ПОПАПЫ---------------------------------------------------------\nvar _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditProfilePopupOpen=_React$useState4[0],setIsEditProfilePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setIsAddPlacePopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isEditAvatarPopupOpen=_React$useState8[0],setIsEditAvatarPopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isImageAvatarPopupOpen=_React$useState10[0],setIsImageAvatarPopupOpen=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isAuthPopupOpen=_React$useState12[0],setIsAuthPopupOpen=_React$useState12[1];var _React$useState13=React.useState(\"\"),_React$useState14=_slicedToArray(_React$useState13,2),isRegSucces=_React$useState14[0],setIsRegSucces=_React$useState14[1];//ПОПАПЫ_________________________________________________________\n//ЮЗЕР И КАРТОЧКИ_---------------------------------------------------\nvar _React$useState15=React.useState({}),_React$useState16=_slicedToArray(_React$useState15,2),selectedCard=_React$useState16[0],setSelectedCard=_React$useState16[1];var _React$useState17=React.useState({}),_React$useState18=_slicedToArray(_React$useState17,2),currentUser=_React$useState18[0],setCurrentUser=_React$useState18[1];var _React$useState19=React.useState([]),_React$useState20=_slicedToArray(_React$useState19,2),cards=_React$useState20[0],setCards=_React$useState20[1];var _React$useState21=React.useState(\"\"),_React$useState22=_slicedToArray(_React$useState21,2),mail=_React$useState22[0],setMail=_React$useState22[1];//ЮЗЕР И КАРТОЧКИ___________________________________________________\n//ИКОНКА ЗАГРУЗКИ---------------------------------------------------\nvar _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),loaderEdit=_React$useState24[0],setLoaderEdit=_React$useState24[1];var _React$useState25=React.useState(false),_React$useState26=_slicedToArray(_React$useState25,2),loaderAdd=_React$useState26[0],setLoaderAdd=_React$useState26[1];var _React$useState27=React.useState(false),_React$useState28=_slicedToArray(_React$useState27,2),loaderAva=_React$useState28[0],setLoaderAva=_React$useState28[1];//ИКОНКА ЗАГРУЗКИ___________________________________________________\nReact.useEffect(function(){console.log(localStorage.getItem(\"token\"));handleTokenCheck();},[loggedIn]);// React.useEffect(() => {\n//   Api.getUserData()\n//     .then((data) => {\n//       setCurrentUser(data);\n//     })\n//     .catch((err) => {\n//       console.log(err);\n//     });\n// }, [loggedIn]);\nfunction handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleImageAvatarPopupClick(){setIsImageAvatarPopupOpen(true);}function handleCardClick(cardData){setSelectedCard(cardData);}function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsAddPlacePopupOpen(false);setIsImageAvatarPopupOpen(false);setIsAuthPopupOpen(false);setSelectedCard({});}React.useEffect(function(){function handleEsc(event){if(event.key===\"Escape\"){closeAllPopups();}}document.addEventListener(\"keydown\",handleEsc);return function(){document.removeEventListener(\"keydown\",handleEsc);};},[]);function handleUpdateUser(data){setLoaderEdit(true);Api.sendUserData(data).then(function(data){setCurrentUser(data);}).then(function(){closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setLoaderEdit(false);});}function handleUpdatAvatar(data){setLoaderAva(true);Api.changeAvatarRequest(data.avatar).then(function(data){setCurrentUser(_objectSpread(_objectSpread({},currentUser),{},{avatar:data.avatar}));}).then(function(){closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setLoaderAva(false);});}function handleAddPlaceSubmit(data){setLoaderAdd(true);Api.sendUserCard(data).then(function(data){setCards([data].concat(_toConsumableArray(cards)));}).then(function(){closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setLoaderAdd(false);});}//CARDS\nReact.useEffect(function(){Api.getCards().then(function(items){setCards(items);}).catch(function(err){console.log(err);});},[]);function handleCardLike(card){//Снова проверяем, есть ли уже лайк на этой карточке\nconsole.log(currentUser._id);var isLiked=card.likes.some(function(i){console.log(i);return i===currentUser._id;});console.log(card);// Отправляем запрос в API и получаем обновлённые данные карточки\nApi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(cards){return cards.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}function handleDeleteClick(card){Api.deleteCardRequest(card._id).then(function(newCard){setCards(function(cards){return cards.filter(function(c){return c!==card;});});}).catch(function(err){console.log(err);});}function handleRegistrationSubmit(data){sendAuth.registration(data).then(function(regData){history(\"/sign-in\");setIsAuthPopupOpen(true);setIsRegSucces(true);console.log(regData);// if (regData.data._id) {\n//     setIsRegSucces(true);\n// }\n}).catch(function(err){setIsAuthPopupOpen(true);setIsRegSucces(false);console.log(err);});}function handleLogInSubmit(data){sendAuth.authorization(data).then(function(logInData){localStorage.setItem(\"token\",logInData.token);setLoggedIn(true);setCurrentUser(data);history(\"/\");return logInData;}).catch(function(err){console.log(err);});}function handleTokenCheck(){var myToken=localStorage.getItem(\"token\");console.log(myToken);if(myToken){sendAuth.checkToken(myToken).then(function(logInData){setCurrentUser(logInData);setMail(logInData.email);console.log(logInData);if(logInData){setLoggedIn(true);console.log(\"done\");history(\"/\");}}).catch(function(err){console.log(\"my\",err);});}}function handleExitAccount(){setMail(\"\");localStorage.removeItem(\"token\");setCurrentUser({});setLoggedIn(false);}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(InfoTooltip,{success:isRegSucces,onClose:closeAllPopups,isOpened:isAuthPopupOpen}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",element:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{children:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(NavButton,{email:false,buttonText:\"\\u0420\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u044F\",redirect:\"/sign-up\"})})}),/*#__PURE__*/_jsx(LogIn,{onSubmit:handleLogInSubmit})]})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",element:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{children:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(NavButton,{email:false,buttonText:\"\\u0412\\u043E\\u0439\\u0442\\u0438\",redirect:\"/sign-in\"})})}),/*#__PURE__*/_jsx(Register,{onSubmit:handleRegistrationSubmit})]})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",element:/*#__PURE__*/_jsxs(ProtectedRoute,{redirectTo:\"/sign-in\",loggedIn:loggedIn,children:[/*#__PURE__*/_jsx(Header,{children:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(NavButton,{loggedIn:loggedIn,onClick:handleExitAccount,email:/*#__PURE__*/_jsx(\"h3\",{className:\"nav__email\",children:mail}),buttonText:\"\\u0412\\u044B\\u0445\\u043E\\u0434\",redirect:\"/sign-in\"})})}),/*#__PURE__*/_jsx(Main,{currentUser:currentUser,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onImagePopup:handleImageAvatarPopupClick,onImage:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleDeleteClick}),/*#__PURE__*/_jsx(EditProfilePopup,{loader:loaderEdit,onUpdateUser:handleUpdateUser,isOpen:isEditProfilePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditAvatarPopup,{loader:loaderAva,onUpdateUser:handleUpdatAvatar,isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(AddPlacePopup,{loader:loaderAdd,onAddCard:handleAddPlaceSubmit,isOpen:isAddPlacePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(PopupWithForm,{title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",name:\"reset-avatar\"}),/*#__PURE__*/_jsx(ImagePopup,{isOpen:isImageAvatarPopupOpen,name:\"press-image\",card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(Footer,{}),\" \"]})})]})]})});}export default App;","map":{"version":3,"sources":["C:/dev/frontend/react-mesto-auth/src/components/App.js"],"names":["React","BrowserRouter","Routes","Route","Link","useNavigate","Main","Footer","PopupWithForm","ImagePopup","Header","Api","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Register","LogIn","InfoTooltip","ProtectedRoute","NavButton","sendAuth","CurrentUserContext","react","App","history","useState","loggedIn","setLoggedIn","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isImageAvatarPopupOpen","setIsImageAvatarPopupOpen","isAuthPopupOpen","setIsAuthPopupOpen","isRegSucces","setIsRegSucces","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","mail","setMail","loaderEdit","setLoaderEdit","loaderAdd","setLoaderAdd","loaderAva","setLoaderAva","useEffect","console","log","localStorage","getItem","handleTokenCheck","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleImageAvatarPopupClick","handleCardClick","cardData","closeAllPopups","handleEsc","event","key","document","addEventListener","removeEventListener","handleUpdateUser","data","sendUserData","then","catch","err","finally","handleUpdatAvatar","changeAvatarRequest","avatar","handleAddPlaceSubmit","sendUserCard","getCards","items","handleCardLike","card","_id","isLiked","likes","some","i","changeLikeCardStatus","newCard","map","c","handleDeleteClick","deleteCardRequest","filter","handleRegistrationSubmit","registration","regData","handleLogInSubmit","authorization","logInData","setItem","token","myToken","checkToken","email","handleExitAccount","removeItem"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport {\r\n  BrowserRouter,\r\n  Routes,\r\n  Route,\r\n  Link,\r\n  useNavigate,\r\n} from \"react-router-dom\";\r\n\r\nimport Main from \"./Main\";\r\nimport Footer from \"./Footer\";\r\nimport PopupWithForm from \"./PopupWithForm\";\r\nimport ImagePopup from \"./ImagePopup\";\r\nimport Header from \"./Header\";\r\nimport Api from \"../utils/Api\";\r\nimport EditProfilePopup from \"./EditProfilePopup\";\r\nimport EditAvatarPopup from \"./EditAvatarPopup\";\r\nimport AddPlacePopup from \"./AddPlacePopup \";\r\nimport Register from \"./Register\";\r\nimport LogIn from \"./Login\";\r\nimport InfoTooltip from \"./InfoToolTip/InfoTooltip\";\r\nimport ProtectedRoute from \"./ProtectedRoute\";\r\nimport NavButton from \"./Nav/NavButton\";\r\nimport sendAuth from \"../utils/Auth\";\r\n\r\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\r\nimport react from \"react\";\r\n\r\nfunction App() {\r\n  const history = useNavigate();\r\n  const [loggedIn, setLoggedIn] = React.useState(false);\r\n  //ПОПАПЫ---------------------------------------------------------\r\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] =\r\n    React.useState(false);\r\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\r\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] =\r\n    React.useState(false);\r\n  const [isImageAvatarPopupOpen, setIsImageAvatarPopupOpen] =\r\n    React.useState(false);\r\n\r\n  const [isAuthPopupOpen, setIsAuthPopupOpen] = React.useState(false);\r\n  const [isRegSucces, setIsRegSucces] = React.useState(\"\");\r\n  //ПОПАПЫ_________________________________________________________\r\n\r\n  //ЮЗЕР И КАРТОЧКИ_---------------------------------------------------\r\n  const [selectedCard, setSelectedCard] = React.useState({});\r\n\r\n  const [currentUser, setCurrentUser] = React.useState({});\r\n\r\n  const [cards, setCards] = React.useState([]);\r\n\r\n  const [mail, setMail] = React.useState(\"\");\r\n  //ЮЗЕР И КАРТОЧКИ___________________________________________________\r\n\r\n  //ИКОНКА ЗАГРУЗКИ---------------------------------------------------\r\n  const [loaderEdit, setLoaderEdit] = React.useState(false);\r\n  const [loaderAdd, setLoaderAdd] = React.useState(false);\r\n  const [loaderAva, setLoaderAva] = React.useState(false);\r\n  //ИКОНКА ЗАГРУЗКИ___________________________________________________\r\n  React.useEffect(() => {\r\n    console.log(localStorage.getItem(\"token\"));\r\n    handleTokenCheck();\r\n  }, [loggedIn]);\r\n\r\n  // React.useEffect(() => {\r\n  //   Api.getUserData()\r\n  //     .then((data) => {\r\n  //       setCurrentUser(data);\r\n  //     })\r\n  //     .catch((err) => {\r\n  //       console.log(err);\r\n  //     });\r\n  // }, [loggedIn]);\r\n\r\n  function handleEditAvatarClick() {\r\n    setIsEditAvatarPopupOpen(true);\r\n  }\r\n\r\n  function handleEditProfileClick() {\r\n    setIsEditProfilePopupOpen(true);\r\n  }\r\n\r\n  function handleAddPlaceClick() {\r\n    setIsAddPlacePopupOpen(true);\r\n  }\r\n\r\n  function handleImageAvatarPopupClick() {\r\n    setIsImageAvatarPopupOpen(true);\r\n  }\r\n\r\n  function handleCardClick(cardData) {\r\n    setSelectedCard(cardData);\r\n  }\r\n\r\n  function closeAllPopups() {\r\n    setIsEditProfilePopupOpen(false);\r\n    setIsEditAvatarPopupOpen(false);\r\n    setIsAddPlacePopupOpen(false);\r\n    setIsImageAvatarPopupOpen(false);\r\n    setIsAuthPopupOpen(false);\r\n    setSelectedCard({});\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    function handleEsc(event) {\r\n      if (event.key === `Escape`) {\r\n        closeAllPopups();\r\n      }\r\n    }\r\n    document.addEventListener(\"keydown\", handleEsc);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleEsc);\r\n    };\r\n  }, []);\r\n\r\n  function handleUpdateUser(data) {\r\n    setLoaderEdit(true);\r\n    Api.sendUserData(data)\r\n      .then((data) => {\r\n        setCurrentUser(data);\r\n      })\r\n      .then(() => {\r\n        closeAllPopups();\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      })\r\n      .finally(() => {\r\n        setLoaderEdit(false);\r\n      });\r\n  }\r\n\r\n  function handleUpdatAvatar(data) {\r\n    setLoaderAva(true);\r\n    Api.changeAvatarRequest(data.avatar)\r\n      .then((data) => {\r\n        setCurrentUser({ ...currentUser, avatar: data.avatar });\r\n      })\r\n      .then(() => {\r\n        closeAllPopups();\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      })\r\n      .finally(() => {\r\n        setLoaderAva(false);\r\n      });\r\n  }\r\n\r\n  function handleAddPlaceSubmit(data) {\r\n    setLoaderAdd(true);\r\n    Api.sendUserCard(data)\r\n      .then((data) => {\r\n        setCards([data, ...cards]);\r\n      })\r\n      .then(() => {\r\n        closeAllPopups();\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      })\r\n      .finally(() => {\r\n        setLoaderAdd(false);\r\n      });\r\n  }\r\n\r\n  //CARDS\r\n\r\n  React.useEffect(() => {\r\n    Api.getCards()\r\n      .then((items) => {\r\n        setCards(items);\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  }, []);\r\n\r\n  function handleCardLike(card) {\r\n    //Снова проверяем, есть ли уже лайк на этой карточке\r\n    console.log(currentUser._id);\r\n    const isLiked = card.likes.some((i) => {\r\n      console.log(i);\r\n      return i === currentUser._id;\r\n    });\r\n    console.log(card);\r\n    // Отправляем запрос в API и получаем обновлённые данные карточки\r\n    Api.changeLikeCardStatus(card._id, !isLiked)\r\n      .then((newCard) => {\r\n        setCards((cards) =>\r\n          cards.map((c) => (c._id === card._id ? newCard : c))\r\n        );\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  }\r\n\r\n  function handleDeleteClick(card) {\r\n    Api.deleteCardRequest(card._id)\r\n      .then((newCard) => {\r\n        setCards((cards) => cards.filter((c) => c !== card));\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  }\r\n\r\n  function handleRegistrationSubmit(data) {\r\n    sendAuth\r\n      .registration(data)\r\n      .then((regData) => {\r\n        history(\"/sign-in\");\r\n        setIsAuthPopupOpen(true);\r\n        setIsRegSucces(true);\r\n        console.log(regData);\r\n        // if (regData.data._id) {\r\n        //     setIsRegSucces(true);\r\n        // }\r\n      })\r\n      .catch((err) => {\r\n        setIsAuthPopupOpen(true);\r\n        setIsRegSucces(false);\r\n\r\n        console.log(err);\r\n      });\r\n  }\r\n  function handleLogInSubmit(data) {\r\n    sendAuth\r\n      .authorization(data)\r\n      .then((logInData) => {\r\n        localStorage.setItem(\"token\", logInData.token);\r\n        setLoggedIn(true);\r\n        setCurrentUser(data);\r\n\r\n        history(\"/\");\r\n\r\n        return logInData;\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  }\r\n\r\n  function handleTokenCheck() {\r\n    const myToken = localStorage.getItem(\"token\");\r\n    console.log(myToken);\r\n    if (myToken) {\r\n      sendAuth\r\n        .checkToken(myToken)\r\n        .then((logInData) => {\r\n          setCurrentUser(logInData);\r\n          setMail(logInData.email);\r\n          console.log(logInData);\r\n          if (logInData) {\r\n            setLoggedIn(true);\r\n            console.log(\"done\");\r\n            history(\"/\");\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          console.log(\"my\", err);\r\n        });\r\n    }\r\n  }\r\n\r\n  function handleExitAccount() {\r\n    setMail(\"\");\r\n    localStorage.removeItem(\"token\");\r\n    setCurrentUser({});\r\n    setLoggedIn(false);\r\n  }\r\n\r\n  return (\r\n    <CurrentUserContext.Provider value={currentUser}>\r\n      <div className=\"App\">\r\n        <InfoTooltip\r\n          success={isRegSucces}\r\n          onClose={closeAllPopups}\r\n          isOpened={isAuthPopupOpen}\r\n        />\r\n\r\n        <Routes>\r\n          <Route\r\n            path=\"/sign-in\"\r\n            element={\r\n              <>\r\n                <Header\r\n                  children={\r\n                    <>\r\n                      <NavButton\r\n                        email={false}\r\n                        buttonText=\"Регистрация\"\r\n                        redirect=\"/sign-up\"\r\n                      />\r\n                    </>\r\n                  }\r\n                />\r\n                <LogIn onSubmit={handleLogInSubmit} />\r\n              </>\r\n            }\r\n          />\r\n          <Route\r\n            path=\"/sign-up\"\r\n            element={\r\n              <>\r\n                <Header\r\n                  children={\r\n                    <>\r\n                      <NavButton\r\n                        email={false}\r\n                        buttonText=\"Войти\"\r\n                        redirect=\"/sign-in\"\r\n                      />\r\n                    </>\r\n                  }\r\n                />\r\n                <Register onSubmit={handleRegistrationSubmit} />\r\n              </>\r\n            }\r\n          />\r\n\r\n          <Route\r\n            exact\r\n            path=\"/\"\r\n            element={\r\n              <ProtectedRoute redirectTo=\"/sign-in\" loggedIn={loggedIn}>\r\n                <Header\r\n                  children={\r\n                    <>\r\n                      <NavButton\r\n                        loggedIn={loggedIn}\r\n                        onClick={handleExitAccount}\r\n                        email={<h3 className=\"nav__email\">{mail}</h3>}\r\n                        buttonText=\"Выход\"\r\n                        redirect=\"/sign-in\"\r\n                      />\r\n                    </>\r\n                  }\r\n                />\r\n                <Main\r\n                  currentUser={currentUser}\r\n                  onEditProfile={handleEditProfileClick}\r\n                  onAddPlace={handleAddPlaceClick}\r\n                  onEditAvatar={handleEditAvatarClick}\r\n                  onImagePopup={handleImageAvatarPopupClick}\r\n                  onImage={handleCardClick}\r\n                  cards={cards}\r\n                  onCardLike={handleCardLike}\r\n                  onCardDelete={handleDeleteClick}\r\n                />\r\n                <EditProfilePopup\r\n                  loader={loaderEdit}\r\n                  onUpdateUser={handleUpdateUser}\r\n                  isOpen={isEditProfilePopupOpen}\r\n                  onClose={closeAllPopups}\r\n                />\r\n                <EditAvatarPopup\r\n                  loader={loaderAva}\r\n                  onUpdateUser={handleUpdatAvatar}\r\n                  isOpen={isEditAvatarPopupOpen}\r\n                  onClose={closeAllPopups}\r\n                />\r\n                <AddPlacePopup\r\n                  loader={loaderAdd}\r\n                  onAddCard={handleAddPlaceSubmit}\r\n                  isOpen={isAddPlacePopupOpen}\r\n                  onClose={closeAllPopups}\r\n                />\r\n                <PopupWithForm title=\"Вы уверены?\" name=\"reset-avatar\" />\r\n                <ImagePopup\r\n                  isOpen={isImageAvatarPopupOpen}\r\n                  name=\"press-image\"\r\n                  card={selectedCard}\r\n                  onClose={closeAllPopups}\r\n                />\r\n                <Footer />{\" \"}\r\n              </ProtectedRoute>\r\n            }\r\n          />\r\n        </Routes>\r\n      </div>\r\n    </CurrentUserContext.Provider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}