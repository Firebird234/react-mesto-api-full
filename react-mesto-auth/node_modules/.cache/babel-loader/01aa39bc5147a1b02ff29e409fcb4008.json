{"ast":null,"code":"import _toConsumableArray from\"C:/dev/frontend/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/dev/frontend/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from\"react\";import{BrowserRouter,Routes,Route,Link,useNavigate}from\"react-router-dom\";import Main from\"./Main\";import Footer from\"./Footer\";import PopupWithForm from\"./PopupWithForm\";import ImagePopup from\"./ImagePopup\";import Header from\"./Header\";import Api from\"../utils/Api\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup \";import Register from\"./Register\";import LogIn from\"./Login\";import InfoTooltip from\"./InfoToolTip/InfoTooltip\";import ProtectedRoute from\"./ProtectedRoute\";import NavButton from\"./Nav/NavButton\";import sendAuth from\"../utils/Auth\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import react from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var history=useNavigate();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),loggedIn=_React$useState2[0],setLoggedIn=_React$useState2[1];//ПОПАПЫ---------------------------------------------------------\nvar _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditProfilePopupOpen=_React$useState4[0],setIsEditProfilePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setIsAddPlacePopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isEditAvatarPopupOpen=_React$useState8[0],setIsEditAvatarPopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isImageAvatarPopupOpen=_React$useState10[0],setIsImageAvatarPopupOpen=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isAuthPopupOpen=_React$useState12[0],setIsAuthPopupOpen=_React$useState12[1];var _React$useState13=React.useState(\"\"),_React$useState14=_slicedToArray(_React$useState13,2),isRegSucces=_React$useState14[0],setIsRegSucces=_React$useState14[1];//ПОПАПЫ_________________________________________________________\n//ЮЗЕР И КАРТОЧКИ_---------------------------------------------------\nvar _React$useState15=React.useState({}),_React$useState16=_slicedToArray(_React$useState15,2),selectedCard=_React$useState16[0],setSelectedCard=_React$useState16[1];var _React$useState17=React.useState({}),_React$useState18=_slicedToArray(_React$useState17,2),currentUser=_React$useState18[0],setCurrentUser=_React$useState18[1];var _React$useState19=React.useState([]),_React$useState20=_slicedToArray(_React$useState19,2),cards=_React$useState20[0],setCards=_React$useState20[1];var _React$useState21=React.useState(\"\"),_React$useState22=_slicedToArray(_React$useState21,2),mail=_React$useState22[0],setMail=_React$useState22[1];//ЮЗЕР И КАРТОЧКИ___________________________________________________\n//ИКОНКА ЗАГРУЗКИ---------------------------------------------------\nvar _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),loaderEdit=_React$useState24[0],setLoaderEdit=_React$useState24[1];var _React$useState25=React.useState(false),_React$useState26=_slicedToArray(_React$useState25,2),loaderAdd=_React$useState26[0],setLoaderAdd=_React$useState26[1];var _React$useState27=React.useState(false),_React$useState28=_slicedToArray(_React$useState27,2),loaderAva=_React$useState28[0],setLoaderAva=_React$useState28[1];//ИКОНКА ЗАГРУЗКИ___________________________________________________\nReact.useEffect(function(){Api.getUserData().then(function(data){setCurrentUser(data);}).catch(function(err){console.log(err);});},[]);function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleImageAvatarPopupClick(){setIsImageAvatarPopupOpen(true);}function handleCardClick(cardData){setSelectedCard(cardData);}function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsAddPlacePopupOpen(false);setIsImageAvatarPopupOpen(false);setIsAuthPopupOpen(false);setSelectedCard({});}React.useEffect(function(){function handleEsc(event){if(event.key===\"Escape\"){closeAllPopups();}}document.addEventListener(\"keydown\",handleEsc);return function(){document.removeEventListener(\"keydown\",handleEsc);};},[]);function handleUpdateUser(data){setLoaderEdit(true);Api.sendUserData(data).then(function(data){setCurrentUser(data);}).then(function(){closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setLoaderEdit(false);});}function handleUpdatAvatar(data){setLoaderAva(true);Api.changeAvatarRequest(data.avatar).then(function(data){setCurrentUser(data);}).then(function(){closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setLoaderAva(false);});}function handleAddPlaceSubmit(data){setLoaderAdd(true);Api.sendUserCard(data).then(function(data){setCards([data].concat(_toConsumableArray(cards)));}).then(function(){closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setLoaderAdd(false);});}//CARDS\nReact.useEffect(function(){Api.getCards().then(function(items){setCards(items);}).catch(function(err){console.log(err);});},[]);function handleCardLike(card){//Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\nApi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setCards(function(cards){return cards.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}function handleDeleteClick(card){Api.deleteCardRequest(card._id).then(function(newCard){setCards(function(cards){return cards.filter(function(c){return c!==card;});});}).catch(function(err){console.log(err);});}function handleRegistrationSubmit(data){sendAuth.registration(data).then(function(regData){history(\"/sign-in\");setIsAuthPopupOpen(true);setIsRegSucces(true);console.log(regData);// if (regData.data._id) {\n//     setIsRegSucces(true);\n// }\n}).catch(function(err){setIsAuthPopupOpen(true);setIsRegSucces(false);console.log(err);});}function handleLogInSubmit(data){sendAuth.authorization(data).then(function(logInData){localStorage.setItem(\"token\",logInData.token);setLoggedIn(true);history(\"/\");return logInData;}).catch(function(err){console.log(err);});}React.useEffect(function(){handleTokenCheck();console.log(\"USEeffect\");},[loggedIn]);function handleTokenCheck(){var myToken=localStorage.getItem(\"token\");if(myToken){sendAuth.checkToken(myToken).then(function(logInData){setMail(logInData.data.email);console.log(logInData.data.email);if(logInData){setLoggedIn(true);history(\"/\");}}).catch(function(err){console.log(err);});}}function handleExitAccount(){setMail(\"\");localStorage.removeItem(\"token\");setLoggedIn(false);}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(InfoTooltip,{success:isRegSucces,onClose:closeAllPopups,isOpened:isAuthPopupOpen}),/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",element:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{children:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(NavButton,{email:false,buttonText:\"\\u0420\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0430\\u0446\\u0438\\u044F\",redirect:\"/sign-up\"})})}),/*#__PURE__*/_jsx(LogIn,{onSubmit:handleLogInSubmit})]})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",element:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{children:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(NavButton,{email:false,buttonText:\"\\u0412\\u043E\\u0439\\u0442\\u0438\",redirect:\"/sign-in\"})})}),/*#__PURE__*/_jsx(Register,{onSubmit:handleRegistrationSubmit})]})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",element:/*#__PURE__*/_jsxs(ProtectedRoute,{redirectTo:\"/sign-in\",loggedIn:loggedIn,children:[/*#__PURE__*/_jsx(Header,{children:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(NavButton,{loggedIn:loggedIn,onClick:handleExitAccount,email:/*#__PURE__*/_jsx(\"h3\",{className:\"nav__email\",children:mail}),buttonText:\"\\u0412\\u044B\\u0445\\u043E\\u0434\",redirect:\"/sign-in\"})})}),/*#__PURE__*/_jsx(Main,{currentUser:currentUser,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onImagePopup:handleImageAvatarPopupClick,onImage:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleDeleteClick}),/*#__PURE__*/_jsx(EditProfilePopup,{loader:loaderEdit,onUpdateUser:handleUpdateUser,isOpen:isEditProfilePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(EditAvatarPopup,{loader:loaderAva,onUpdateUser:handleUpdatAvatar,isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(AddPlacePopup,{loader:loaderAdd,onAddCard:handleAddPlaceSubmit,isOpen:isAddPlacePopupOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(PopupWithForm,{title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",name:\"reset-avatar\"}),/*#__PURE__*/_jsx(ImagePopup,{isOpen:isImageAvatarPopupOpen,name:\"press-image\",card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(Footer,{}),\" \"]})})]})]})});}export default App;","map":{"version":3,"sources":["C:/dev/frontend/react-mesto-auth/src/components/App.js"],"names":["React","BrowserRouter","Routes","Route","Link","useNavigate","Main","Footer","PopupWithForm","ImagePopup","Header","Api","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Register","LogIn","InfoTooltip","ProtectedRoute","NavButton","sendAuth","CurrentUserContext","react","App","history","useState","loggedIn","setLoggedIn","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isImageAvatarPopupOpen","setIsImageAvatarPopupOpen","isAuthPopupOpen","setIsAuthPopupOpen","isRegSucces","setIsRegSucces","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","mail","setMail","loaderEdit","setLoaderEdit","loaderAdd","setLoaderAdd","loaderAva","setLoaderAva","useEffect","getUserData","then","data","catch","err","console","log","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleImageAvatarPopupClick","handleCardClick","cardData","closeAllPopups","handleEsc","event","key","document","addEventListener","removeEventListener","handleUpdateUser","sendUserData","finally","handleUpdatAvatar","changeAvatarRequest","avatar","handleAddPlaceSubmit","sendUserCard","getCards","items","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","map","c","handleDeleteClick","deleteCardRequest","filter","handleRegistrationSubmit","registration","regData","handleLogInSubmit","authorization","logInData","localStorage","setItem","token","handleTokenCheck","myToken","getItem","checkToken","email","handleExitAccount","removeItem"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport {\r\n    BrowserRouter,\r\n    Routes,\r\n    Route,\r\n    Link,\r\n    useNavigate,\r\n} from \"react-router-dom\";\r\n\r\nimport Main from \"./Main\";\r\nimport Footer from \"./Footer\";\r\nimport PopupWithForm from \"./PopupWithForm\";\r\nimport ImagePopup from \"./ImagePopup\";\r\nimport Header from \"./Header\";\r\nimport Api from \"../utils/Api\";\r\nimport EditProfilePopup from \"./EditProfilePopup\";\r\nimport EditAvatarPopup from \"./EditAvatarPopup\";\r\nimport AddPlacePopup from \"./AddPlacePopup \";\r\nimport Register from \"./Register\";\r\nimport LogIn from \"./Login\";\r\nimport InfoTooltip from \"./InfoToolTip/InfoTooltip\";\r\nimport ProtectedRoute from \"./ProtectedRoute\";\r\nimport NavButton from \"./Nav/NavButton\";\r\nimport sendAuth from \"../utils/Auth\";\r\n\r\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\r\nimport react from \"react\";\r\n\r\nfunction App() {\r\n    const history = useNavigate();\r\n    const [loggedIn, setLoggedIn] = React.useState(false);\r\n    //ПОПАПЫ---------------------------------------------------------\r\n    const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] =\r\n        React.useState(false);\r\n    const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\r\n    const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] =\r\n        React.useState(false);\r\n    const [isImageAvatarPopupOpen, setIsImageAvatarPopupOpen] =\r\n        React.useState(false);\r\n\r\n    const [isAuthPopupOpen, setIsAuthPopupOpen] = React.useState(false);\r\n    const [isRegSucces, setIsRegSucces] = React.useState(\"\");\r\n    //ПОПАПЫ_________________________________________________________\r\n\r\n    //ЮЗЕР И КАРТОЧКИ_---------------------------------------------------\r\n    const [selectedCard, setSelectedCard] = React.useState({});\r\n\r\n    const [currentUser, setCurrentUser] = React.useState({});\r\n\r\n    const [cards, setCards] = React.useState([]);\r\n\r\n    const [mail, setMail] = React.useState(\"\");\r\n    //ЮЗЕР И КАРТОЧКИ___________________________________________________\r\n\r\n    //ИКОНКА ЗАГРУЗКИ---------------------------------------------------\r\n    const [loaderEdit, setLoaderEdit] = React.useState(false);\r\n    const [loaderAdd, setLoaderAdd] = React.useState(false);\r\n    const [loaderAva, setLoaderAva] = React.useState(false);\r\n    //ИКОНКА ЗАГРУЗКИ___________________________________________________\r\n\r\n    React.useEffect(() => {\r\n        Api.getUserData()\r\n            .then((data) => {\r\n                setCurrentUser(data);\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            });\r\n    }, []);\r\n\r\n    function handleEditAvatarClick() {\r\n        setIsEditAvatarPopupOpen(true);\r\n    }\r\n\r\n    function handleEditProfileClick() {\r\n        setIsEditProfilePopupOpen(true);\r\n    }\r\n\r\n    function handleAddPlaceClick() {\r\n        setIsAddPlacePopupOpen(true);\r\n    }\r\n\r\n    function handleImageAvatarPopupClick() {\r\n        setIsImageAvatarPopupOpen(true);\r\n    }\r\n\r\n    function handleCardClick(cardData) {\r\n        setSelectedCard(cardData);\r\n    }\r\n\r\n    function closeAllPopups() {\r\n        setIsEditProfilePopupOpen(false);\r\n        setIsEditAvatarPopupOpen(false);\r\n        setIsAddPlacePopupOpen(false);\r\n        setIsImageAvatarPopupOpen(false);\r\n        setIsAuthPopupOpen(false);\r\n        setSelectedCard({});\r\n    }\r\n\r\n    React.useEffect(() => {\r\n        function handleEsc(event) {\r\n            if (event.key === `Escape`) {\r\n                closeAllPopups();\r\n            }\r\n        }\r\n        document.addEventListener(\"keydown\", handleEsc);\r\n\r\n        return () => {\r\n            document.removeEventListener(\"keydown\", handleEsc);\r\n        };\r\n    }, []);\r\n\r\n    function handleUpdateUser(data) {\r\n        setLoaderEdit(true);\r\n        Api.sendUserData(data)\r\n            .then((data) => {\r\n                setCurrentUser(data);\r\n            })\r\n            .then(() => {\r\n                closeAllPopups();\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            })\r\n            .finally(() => {\r\n                setLoaderEdit(false);\r\n            });\r\n    }\r\n\r\n    function handleUpdatAvatar(data) {\r\n        setLoaderAva(true);\r\n        Api.changeAvatarRequest(data.avatar)\r\n            .then((data) => {\r\n                setCurrentUser(data);\r\n            })\r\n            .then(() => {\r\n                closeAllPopups();\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            })\r\n            .finally(() => {\r\n                setLoaderAva(false);\r\n            });\r\n    }\r\n\r\n    function handleAddPlaceSubmit(data) {\r\n        setLoaderAdd(true);\r\n        Api.sendUserCard(data)\r\n            .then((data) => {\r\n                setCards([data, ...cards]);\r\n            })\r\n            .then(() => {\r\n                closeAllPopups();\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            })\r\n            .finally(() => {\r\n                setLoaderAdd(false);\r\n            });\r\n    }\r\n\r\n    //CARDS\r\n\r\n    React.useEffect(() => {\r\n        Api.getCards()\r\n            .then((items) => {\r\n                setCards(items);\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            });\r\n    }, []);\r\n\r\n    function handleCardLike(card) {\r\n        //Снова проверяем, есть ли уже лайк на этой карточке\r\n        const isLiked = card.likes.some((i) => {\r\n            return i._id === currentUser._id;\r\n        });\r\n\r\n        // Отправляем запрос в API и получаем обновлённые данные карточки\r\n        Api.changeLikeCardStatus(card._id, !isLiked)\r\n            .then((newCard) => {\r\n                setCards((cards) =>\r\n                    cards.map((c) => (c._id === card._id ? newCard : c))\r\n                );\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            });\r\n    }\r\n\r\n    function handleDeleteClick(card) {\r\n        Api.deleteCardRequest(card._id)\r\n            .then((newCard) => {\r\n                setCards((cards) => cards.filter((c) => c !== card));\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            });\r\n    }\r\n\r\n    function handleRegistrationSubmit(data) {\r\n        sendAuth\r\n            .registration(data)\r\n            .then((regData) => {\r\n                history(\"/sign-in\");\r\n                setIsAuthPopupOpen(true);\r\n                setIsRegSucces(true);\r\n                console.log(regData);\r\n                // if (regData.data._id) {\r\n                //     setIsRegSucces(true);\r\n                // }\r\n            })\r\n            .catch((err) => {\r\n                setIsAuthPopupOpen(true);\r\n                setIsRegSucces(false);\r\n\r\n                console.log(err);\r\n            });\r\n    }\r\n    function handleLogInSubmit(data) {\r\n        sendAuth\r\n            .authorization(data)\r\n            .then((logInData) => {\r\n                localStorage.setItem(\"token\", logInData.token);\r\n                setLoggedIn(true);\r\n\r\n                history(\"/\");\r\n\r\n                return logInData;\r\n            })\r\n            .catch((err) => {\r\n                console.log(err);\r\n            });\r\n    }\r\n\r\n    React.useEffect(() => {\r\n        handleTokenCheck();\r\n        console.log(\"USEeffect\");\r\n    }, [loggedIn]);\r\n    function handleTokenCheck() {\r\n        const myToken = localStorage.getItem(\"token\");\r\n        if (myToken) {\r\n            sendAuth\r\n                .checkToken(myToken)\r\n                .then((logInData) => {\r\n                    setMail(logInData.data.email);\r\n                    console.log(logInData.data.email);\r\n                    if (logInData) {\r\n                        setLoggedIn(true);\r\n\r\n                        history(\"/\");\r\n                    }\r\n                })\r\n                .catch((err) => {\r\n                    console.log(err);\r\n                });\r\n        }\r\n    }\r\n\r\n    function handleExitAccount() {\r\n        setMail(\"\");\r\n        localStorage.removeItem(\"token\");\r\n        setLoggedIn(false);\r\n    }\r\n\r\n    return (\r\n        <CurrentUserContext.Provider value={currentUser}>\r\n            <div className=\"App\">\r\n                <InfoTooltip\r\n                    success={isRegSucces}\r\n                    onClose={closeAllPopups}\r\n                    isOpened={isAuthPopupOpen}\r\n                />\r\n\r\n                <Routes>\r\n                    <Route\r\n                        path=\"/sign-in\"\r\n                        element={\r\n                            <>\r\n                                <Header\r\n                                    children={\r\n                                        <>\r\n                                            <NavButton\r\n                                                email={false}\r\n                                                buttonText=\"Регистрация\"\r\n                                                redirect=\"/sign-up\"\r\n                                            />\r\n                                        </>\r\n                                    }\r\n                                />\r\n                                <LogIn onSubmit={handleLogInSubmit} />\r\n                            </>\r\n                        }\r\n                    />\r\n                    <Route\r\n                        path=\"/sign-up\"\r\n                        element={\r\n                            <>\r\n                                <Header\r\n                                    children={\r\n                                        <>\r\n                                            <NavButton\r\n                                                email={false}\r\n                                                buttonText=\"Войти\"\r\n                                                redirect=\"/sign-in\"\r\n                                            />\r\n                                        </>\r\n                                    }\r\n                                />\r\n                                <Register onSubmit={handleRegistrationSubmit} />\r\n                            </>\r\n                        }\r\n                    />\r\n\r\n                    <Route\r\n                        exact\r\n                        path=\"/\"\r\n                        element={\r\n                            <ProtectedRoute\r\n                                redirectTo=\"/sign-in\"\r\n                                loggedIn={loggedIn}\r\n                            >\r\n                                <Header\r\n                                    children={\r\n                                        <>\r\n                                            <NavButton\r\n                                                loggedIn={loggedIn}\r\n                                                onClick={handleExitAccount}\r\n                                                email={\r\n                                                    <h3 className=\"nav__email\">\r\n                                                        {mail}\r\n                                                    </h3>\r\n                                                }\r\n                                                buttonText=\"Выход\"\r\n                                                redirect=\"/sign-in\"\r\n                                            />\r\n                                        </>\r\n                                    }\r\n                                />\r\n                                <Main\r\n                                    currentUser={currentUser}\r\n                                    onEditProfile={handleEditProfileClick}\r\n                                    onAddPlace={handleAddPlaceClick}\r\n                                    onEditAvatar={handleEditAvatarClick}\r\n                                    onImagePopup={handleImageAvatarPopupClick}\r\n                                    onImage={handleCardClick}\r\n                                    cards={cards}\r\n                                    onCardLike={handleCardLike}\r\n                                    onCardDelete={handleDeleteClick}\r\n                                />\r\n                                <EditProfilePopup\r\n                                    loader={loaderEdit}\r\n                                    onUpdateUser={handleUpdateUser}\r\n                                    isOpen={isEditProfilePopupOpen}\r\n                                    onClose={closeAllPopups}\r\n                                />\r\n                                <EditAvatarPopup\r\n                                    loader={loaderAva}\r\n                                    onUpdateUser={handleUpdatAvatar}\r\n                                    isOpen={isEditAvatarPopupOpen}\r\n                                    onClose={closeAllPopups}\r\n                                />\r\n                                <AddPlacePopup\r\n                                    loader={loaderAdd}\r\n                                    onAddCard={handleAddPlaceSubmit}\r\n                                    isOpen={isAddPlacePopupOpen}\r\n                                    onClose={closeAllPopups}\r\n                                />\r\n                                <PopupWithForm\r\n                                    title=\"Вы уверены?\"\r\n                                    name=\"reset-avatar\"\r\n                                />\r\n                                <ImagePopup\r\n                                    isOpen={isImageAvatarPopupOpen}\r\n                                    name=\"press-image\"\r\n                                    card={selectedCard}\r\n                                    onClose={closeAllPopups}\r\n                                />\r\n                                <Footer />{\" \"}\r\n                            </ProtectedRoute>\r\n                        }\r\n                    />\r\n                </Routes>\r\n            </div>\r\n        </CurrentUserContext.Provider>\r\n    );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}